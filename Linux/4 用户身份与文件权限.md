## 用户身份与能力
### 身份
UID 为 0 ：系统的管理员用户；
UID 为 1~999：系统用户（Linux默认服务程序由独立的系统用户负责运行）；
UID 为 1000~ ：由管理员创建的用于日常工作的用户。

### 用户命令
#### id命令
`id 用户名` 
显示用户的详细信息。

#### useradd命令
`useradd [参数] 用户名`
创建用户账户，默认将用户的家目录放在 /home 目录中，其Shell解释器默认为 /bin/bash，
参数：
- `-d`  指定用户的家目录
- `-e` 指定账户到期时间，格式为`YYYY-MM-DD`
- `-u` 指定该用户的默认UID
- `-g` 指定一个出事的用户基本组（必须已经存在）
- `-G`指定一个或多个用户扩展组
- `-N` 不创建与用户同名的基本用户组
- `-S` 指定该用户的默认Shell解释器

例如，指定解释器为 nologin：
```Shell
useradd -d /home/linux -u 8888 -s /sbin/nologin linuxdown
```
其中 \\bin\\nologin 为终端解释器的一员，设置该解释器后该用户无法登录到系统中。

#### groupadd命令
`groupadd [参数] 群组名`
创建新的用户组。

#### usermod命令
`usermod [参数] 用户名`
修改用户的属性。
用户信息保存在 \\etc\\passwd 文件中，也可以直接使用文本编辑器来修改其中的配置信息。
参数：
- `-c` 填写用户账户的备注信息
- `-d -m` 重新指定用户的家目录并自动转移旧的数据
- `-e` 修改账户到期时间
- `-g`  变更所属用户组
- `-G` 变更扩展用户组
- `-L` 锁定用户禁止其登录系统
- `-U` 解锁用户，允许其登录系统
- `-s` 修改默认终端
- `-u` 修改UID
例如，将用户加入 root 用户组：
```Shell
usermod -G root linuxprobe
```

#### passwd命令
`passwd [参数] 用户名`
修改用户的密码，过期时间等信息。
普通用户只能使用 `passwd` 命令修改自己的密码，root 管理员可以修改其他所有人的密码并且无需验证旧密码。
参数：
- `-l` 锁定用户，禁止其登录
- `-u` 解除锁定，允许用户登录
- `--stdin` 通过标准输入修改用户密码
- `-d` 使该用户可以使用空密码登录
- `-e` 强制用户在下次登录时修改密码
- `-S` 显示用户的密码是否被锁定，以及密码采用的加密算法名称
若要修自己的密码，只要输入 `passwd` 再敲击回车即可。

#### userdel命令
`userdel [参数] 用户名`
删除已有的用户账户。
参数：
- `-f` 强制删除用户
- `-r` 同时删除用户及用户的家目录


## 文件权限与归属
### 文件权限
对于文件：
- 可读（r）：能够读取文件内容
- 可写（w）：能够编辑文件内容
- 可执行（x）：能够运行该脚本程序
对于目录：
- 可读（r）：能够读取目录文件列表
- 可写（w）：能够再目录中编辑、新建、修改、重命名文件
- 可执行（x）：能进入该目录

数字表示：
- 可读：4
- 可写：2
- 可执行：1

表示文件权限时，按照文件所有者、文件所属组、其他用户的顺序来列出权限，使用 - 来占位表示没有权限。

再查看文件权限情况时，在权限前面的符号表示文件的类型，其中
- - ：普通文件
- d ： 目录文件
- l ：链接文件
- p ：管道文件
- b ：块设备文件
- c ：字符设备文件

例如：
```Shell
ls -l install.log
-rw-r--r--  1  root  root  34298  34-32  00:23  install.log
```
其中，第一个 - 表示文件类型为普通文件，接下来的 rw-、r--、r-- 分别表示文件所有者、文件所属组、其他用户对该文件的权限，后面的第一个 root 表示文件所有者，第二个 root 表示文件所属组，34298 表示文件大小为 34298 字节，最近一次修改时间为 4 月 2 日的 00:23，文件名称为 install.log.
用数字表示法来表示上述权限，rw-、r--、r-- 分别为 420、400、400，每一组求和为 6、4、4，则其权限可以写为 644.

### 文件的特殊权限
#### SUID权限
SUID权限可以使二进制程序执行者拥有二进制程序所有者的权限，
当用户拥有SUID权限时，原本有 x 执行权限会被替换为 s，原本无 x 权限则会被替换为 S.

#### SGID权限
SGID权限的功能：
- 对二进制程序进行设置时，能使执行者临时获取文件所属组的权限；
- 对目录进行设置时，使目录内创建的文件自动继承该目录原有用户组的名称。
当用户拥有SGID权限时，原本有 x 执行权限会被替换为 s，原本无 x 权限则会被替换为 S.

#### SBIT权限
SBIT权限可以确保用户只能删除自己的文件，而不能删除其他用户的文件。
一般设置于其他用户的权限位上。
当文件被设置 SBIT 权限后，原本有 x 执行权限会被替换为 t，原本无 x 权限则会被替换为 T.

### 更改文件权限命令
#### chmod命令
`chmod [参数] 文件名`
用于设置文件的一般权限及特殊权限，
例如，设置文件权限为 rwxrw---- ，数字表示法为 760 ：
```Shell
chmod 760 anaconda-ks.cfg
```

设置特殊权限的参数（在一般权限已经设置完毕的情况下）：
- `u + s` 设置 SUID 权限
- `u - s` 取消 SUID 权限
- `g + s` 设置 SGID 权限
- `g - s` 取消 SGID 权限
- `o + t` 设置 SBIT 权限
- `o - t` 取消 SBIT 权限

#### chown命令
`chown 所有者:所有组 文件名`
用于设置文件的所有者和所有组，
例如，修改文件所有者和所属组均为 linuxprobe：
```Shell
chown linuxprobe:linuxprobe anaconda-ks.cfg
```


上述两个命令在对目录操作时需要加上参数 `-R` 俩递归操作，即对目录的所有文件进行整体操作。
数字表示法中，SUID、SGID、SBIT 分别为 4、2、1，表示为 “特殊权限 + 一般权限”。
例如，`rwxr-xr-t` 权限中，一般权限为 `rwxr-xr-x`，数字表示为 755，特殊权限数字表示为 1，总的数字表示为 1755.

### 文件的隐藏属性
#### chattr命令
`chattr [参数] 文件名称`
用于设置文件的隐藏权限，
若需要某个隐藏功能添加到文件上，应该使用 '+ 参数'；若要将某个隐藏功能移出文件，应该使用 ‘- 参数’。

参数：
- `i` 无法对文件进行修改，若目录设置了该参数，则仅能修改其中的子文件内容而不能新建或者删除文件
- `a` 仅允许补充（追加）内容，无法覆盖/删除内容
- `S` 文件内容变更后立即同步到硬盘
- `s` 彻底从硬盘中删除，不可恢复（用零块填充源文件所在硬盘区域）
- `A` 不再修改文件或者目录的最后访问时间
- `b` 不再修改文件或目录的存取时间
- `D` 检查压缩文件中的错误
- `d` 使用 dump 命令备份时忽略该文件/目录
- `c` 默认将文件或者目录进行压缩
- `u` 当删除该文件后依然保留其在硬盘中的数据，方便日后回复 
- `t` 使文件系统支持尾部合并
- `x` 可以直接访问压缩文件中的内容


#### lsattr命令
`lsattr [参数] 文件命令` 
用于查看文件的隐藏属性，一般的 `ls` 命令无法查看文件的隐藏属性。
例如，
```Shell
lsattr linuxprobe
-----a---------- linuxprobe
```
而使用 `ls` 命令，
```Shell
ls -al linuxprobe
-rw-r--r--. 1 root root 9 Feb 12 11:42 linuxprobe
```


### 文件访问控制列表
上述权限设置方式都是针对某一类用户设置的，能够对很多用户同时生效。
若要对某个指定的用户或用户组单独进行权限控制，需要使用文件的访问控制列表（ALC）。

若针对某个目录设置了 ACL，则目录中的文件会继承其 ACL 权限；若针对文件设置了 ACL，则文件不再继承其所在目录的 ACL 权限。

#### setfacl命令
`setfacl [参数] 文件名称`
用于管理文件的ACL权限规则，可以针对单一用户或者单一用户组、单一文件或者目录来进行读/写/执行权限的控制。

参数：
- `-m` 修改权限
- `-M` 从文件中读取权限
- `-x` 删除某个权限
- `-b` 删除全部权限
- `-R` 递归子目录

在通常情况下，普通用户无法进入 /root 目录，设置ACL权限后即可以进入：
```Shell
setfacl -Rm u:linuxprobe:rwx /root
```
若对用户组进行设置，只需要将 u 改为 g：
```Shell
setfacl -Rm g:linuxprobe:rwx /root
```
在文件设置了ACL权限之后，使用 `ls` 命令查看文件权限时，文件权限列表最后的（.）会变成（+）。

#### getfcal命令
`getfacl [参数] 文件名称`
用于查看文件的ACL权限规则。

#### 备份文件ACL权限
ACL权限设置是立即且永久生效的，导致在权限设置错误时会永久覆盖原有配置。
例如，备份 /home 目录上的ACL权限时：
```Shell
getfcal -R /home > backup.acl
```
恢复原有权限时，只需要：
```Shell
setfcal --restore backup.acl
```


### su命令与sudo服务
#### su命令
su命令可以使当前用户在不退出登录的情况下切换为其他用户。
例如，从 root管理员切换为普通用户：
```Shell
su - linxuprobe
```
命令中的（-）参数表示完全切换为新的用户，即环境变量也切换为新用户的环境变量。
普通用户切换为 root管理员时，需要进行密码验证。

#### sudo命令
`sudo [参数] 用户名`
用于给普通用户提供额外的权限。
使用 `sudo` 命令可以给普通用户提供额外的权限来完成原本只有root管理员才能完成的任务，限制用户执行指定的命令，记录用户执行过的每一条命令，集中管理用户与权限（/etc/sudoers），在验证密码后的一段时间无须让用户再次验证密码。

参数：
- `-l` 列出当前用户可执行的命令
- `-u 用户名或ID值` 以指定的用户身份执行命令
- `-k` 清空密码有效时间，下次执行sudo时需要再次进行密码验证
- `-b` 在后台执行指定的命令
- `-p` 更改询问密码的提示语

#### visudo命令
`visudo [参数]`
用于编辑、配置用户sudo的权限文件，只有root管理员有权限执行。

visudo命令会自动调用ci编辑器来编辑/etc/sudoers权限文件，可以对配置文件内的参数进行语法检查。

在配置权限文件时，需要在末行按照如下格式填写信息：
**使用用户 允许使用的主机 = （需求用户的身份） 可执行的命令列表**
允许使用的主机：填写ALL表示不限制主机来源，亦可填写网段来限制来源地址，使得只有从该网段登录时才允许使用sudo命令。
需求用户的身份：填写ALL表示不限制，也可填写某个用户名。
可执行命令列表：填写ALL表示不限制命令，填写命令文件的绝对路径来指定命令，多个命令之间以（,）间隔。
在可执行的命令列表前添加 `NOPASSWORD:`参数可以使用户在使用sudo命令时只需要进行一次密码验证。